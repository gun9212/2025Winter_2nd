# ê°œë°œ ì‘ì—… ìˆœì„œ ê°€ì´ë“œ

ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šê³ , ê¸°ëŠ¥ë³„ë¡œ ì™„ì„±í•˜ëŠ” ìˆœì„œë¡œ ì •ë¦¬í•œ ìƒì„¸ ì‘ì—… ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸ“‹ ì „ì²´ ì‘ì—… ìˆœì„œ

```
Phase 1: ìœ„ì¹˜ ì—…ë°ì´íŠ¸ API ì™„ì„± (ìµœìš°ì„ )
  â†“
Phase 2: í”„ë¡œí•„ ê´€ë¦¬ ì‹œìŠ¤í…œ ì™„ì„±
  â†“
Phase 3: ì´ìƒí˜• í”„ë¡œí•„ ì‹œìŠ¤í…œ ì™„ì„±
  â†“
Phase 4: ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ & ì‹œìŠ¤í…œ ì™„ì„±
  â†“
Phase 5: ì„œë¹„ìŠ¤ ì„¤ì • ê¸°ëŠ¥ ì™„ì„±
  â†“
Phase 6: ì•Œë¦¼ ì‹œìŠ¤í…œ ì™„ì„±
  â†“
Phase 7: í†µí•© í…ŒìŠ¤íŠ¸ & ìµœì¢… ì ê²€
```

---

## Phase 1: ìœ„ì¹˜ ì—…ë°ì´íŠ¸ API ì™„ì„± â­â­â­â­â­

**ëª©í‘œ**: GPS ìœ„ì¹˜ ì •ë³´ë¥¼ DBì— ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ ì™„ì„±

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 1-2ì‹œê°„

### 1-1. ë°±ì—”ë“œ: Serializer ìƒì„±

**íŒŒì¼**: `backend/apps/users/serializers.py`

**ì‘ì—… ë‚´ìš©**:
```python
# ê¸°ì¡´ íŒŒì¼ì— ì¶”ê°€
from rest_framework import serializers
from .models import UserLocation

class UserLocationSerializer(serializers.ModelSerializer):
    class Meta:
        model = UserLocation
        fields = ['latitude', 'longitude']
    
    def validate_latitude(self, value):
        if not (-90 <= value <= 90):
            raise serializers.ValidationError("ìœ„ë„ëŠ” -90~90 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.")
        return value
    
    def validate_longitude(self, value):
        if not (-180 <= value <= 180):
            raise serializers.ValidationError("ê²½ë„ëŠ” -180~180 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.")
        return value
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `UserLocationSerializer` í´ë˜ìŠ¤ ìƒì„±
- [ ] ìœ„ë„/ê²½ë„ ë²”ìœ„ ê²€ì¦ ì¶”ê°€
- [ ] ì €ì¥ í…ŒìŠ¤íŠ¸

---

### 1-2. ë°±ì—”ë“œ: View êµ¬í˜„

**íŒŒì¼**: `backend/apps/users/views.py`

**ì‘ì—… ë‚´ìš©**:
```python
from rest_framework.decorators import api_view, permission_classes
from rest_framework.permissions import IsAuthenticated
from rest_framework.response import Response
from rest_framework import status
from .models import UserLocation
from .serializers import UserLocationSerializer

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def update_location(request):
    serializer = UserLocationSerializer(data=request.data)
    if serializer.is_valid():
        # upsert (ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ìƒì„±)
        location, created = UserLocation.objects.update_or_create(
            user=request.user.profile,  # AuthUser -> User í”„ë¡œí•„
            defaults={
                'latitude': serializer.validated_data['latitude'],
                'longitude': serializer.validated_data['longitude'],
            }
        )
        return Response({
            'success': True,
            'message': 'ìœ„ì¹˜ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.',
            'data': UserLocationSerializer(location).data
        }, status=status.HTTP_200_OK)
    return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `update_location` í•¨ìˆ˜ êµ¬í˜„
- [ ] JWT ì¸ì¦ í™•ì¸
- [ ] upsert ë¡œì§ êµ¬í˜„
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€

---

### 1-3. ë°±ì—”ë“œ: URL ë¼ìš°íŒ…

**íŒŒì¼**: `backend/apps/users/urls.py`

**ì‘ì—… ë‚´ìš©**:
```python
from django.urls import path
from . import views

app_name = 'users'

urlpatterns = [
    path('location/update/', views.update_location, name='update_location'),
]
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] URL íŒ¨í„´ ì¶”ê°€
- [ ] ê²½ë¡œ í™•ì¸: `/api/users/location/update/`

---

### 1-4. ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸

**ì‘ì—… ë‚´ìš©**:
```bash
# Django ì„œë²„ ì‹¤í–‰
cd backend
source venv/bin/activate
python manage.py runserver

# ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ í…ŒìŠ¤íŠ¸ (Postman ë˜ëŠ” curl)
curl -X POST http://localhost:8000/api/users/location/update/ \
  -H "Authorization: Bearer <access_token>" \
  -H "Content-Type: application/json" \
  -d '{"latitude": 37.5665, "longitude": 126.9780}'
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ë¡œê·¸ì¸ í›„ í† í° ë°œê¸‰ í™•ì¸
- [ ] ìœ„ì¹˜ ì—…ë°ì´íŠ¸ API í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] DBì— ìœ„ì¹˜ ì •ë³´ ì €ì¥ í™•ì¸
- [ ] ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ (ì˜ëª»ëœ ìœ„ë„/ê²½ë„ ë“±)

---

### 1-5. í”„ë¡ íŠ¸ì—”ë“œ í™•ì¸ ë° ìˆ˜ì •

**íŒŒì¼**: `Frontend/IdealMatchApp/src/services/api/apiClient.js`

**í™•ì¸ ì‚¬í•­**:
- [ ] `updateLocation` í•¨ìˆ˜ê°€ ì˜¬ë°”ë¥¸ ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œí•˜ëŠ”ì§€ í™•ì¸
- [ ] ì—ëŸ¬ ì²˜ë¦¬ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- [ ] í† í°ì´ ìë™ìœ¼ë¡œ ì²¨ë¶€ë˜ëŠ”ì§€ í™•ì¸

**í•„ìš”ì‹œ ìˆ˜ì •**:
```javascript
// í˜„ì¬ ì½”ë“œ í™•ì¸ í›„ ê²½ë¡œê°€ ë‹¤ë¥´ë©´ ìˆ˜ì •
async updateLocation(latitude, longitude) {
  const response = await this.request('/users/location/update/', {
    method: 'POST',
    body: JSON.stringify({
      latitude,
      longitude,
    }),
  });
  // ...
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œ í™•ì¸
- [ ] ì‹¤ì œ ì•±ì—ì„œ ìœ„ì¹˜ ì „ì†¡ í…ŒìŠ¤íŠ¸
- [ ] ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸

---

### Phase 1 ì™„ë£Œ ê¸°ì¤€

- [ ] ë°±ì—”ë“œ APIê°€ ì •ìƒ ì‘ë™
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìœ„ì¹˜ ì •ë³´ê°€ DBì— ì €ì¥ë¨
- [ ] ì—ëŸ¬ ì²˜ë¦¬ê°€ ì •ìƒ ì‘ë™

---

## Phase 2: í”„ë¡œí•„ ê´€ë¦¬ ì‹œìŠ¤í…œ ì™„ì„± â­â­â­â­

**ëª©í‘œ**: ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ, ìƒì„±, ìˆ˜ì • ê¸°ëŠ¥ ì™„ì„±

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 2-3ì‹œê°„

### 2-1. ë°±ì—”ë“œ: UserSerializer ìƒì„±

**íŒŒì¼**: `backend/apps/users/serializers.py`

**ì‘ì—… ë‚´ìš©**:
```python
from .models import User

class UserSerializer(serializers.ModelSerializer):
    class Meta:
        model = User
        fields = ['age', 'gender', 'height', 'mbti', 'personality', 'interests']
        read_only_fields = ['created_at', 'updated_at']
    
    def validate_personality(self, value):
        if not value or len(value) == 0:
            raise serializers.ValidationError("ì„±ê²© ìœ í˜•ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.")
        return value
    
    def validate_interests(self, value):
        if not value or len(value) == 0:
            raise serializers.ValidationError("ê´€ì‹¬ì‚¬ë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.")
        return value
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `UserSerializer` í´ë˜ìŠ¤ ìƒì„±
- [ ] í•„ìˆ˜ í•„ë“œ ê²€ì¦ ì¶”ê°€
- [ ] ì„±ê²©/ê´€ì‹¬ì‚¬ ìµœì†Œ 1ê°œ ê²€ì¦

---

### 2-2. ë°±ì—”ë“œ: í”„ë¡œí•„ View êµ¬í˜„

**íŒŒì¼**: `backend/apps/users/views.py`

**ì‘ì—… ë‚´ìš©**:
```python
from .models import User
from .serializers import UserSerializer

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_profile(request):
    try:
        profile = request.user.profile
        serializer = UserSerializer(profile)
        return Response({
            'success': True,
            'data': serializer.data
        }, status=status.HTTP_200_OK)
    except User.DoesNotExist:
        return Response({
            'success': False,
            'message': 'í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.'
        }, status=status.HTTP_404_NOT_FOUND)

@api_view(['POST', 'PUT'])
@permission_classes([IsAuthenticated])
def update_profile(request):
    try:
        profile = request.user.profile
        serializer = UserSerializer(profile, data=request.data, partial=request.method == 'PUT')
    except User.DoesNotExist:
        # í”„ë¡œí•„ì´ ì—†ìœ¼ë©´ ìƒì„±
        serializer = UserSerializer(data=request.data)
    
    if serializer.is_valid():
        serializer.save(user=request.user.profile.user if hasattr(request.user, 'profile') else request.user)
        return Response({
            'success': True,
            'message': 'í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.',
            'data': serializer.data
        }, status=status.HTTP_200_OK)
    return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def check_profile_completeness(request):
    try:
        profile = request.user.profile
        ideal_type = profile.ideal_type_profile
        
        # í”„ë¡œí•„ ì™„ì„±ë„ ì²´í¬
        profile_fields = ['age', 'gender', 'height', 'mbti', 'personality', 'interests']
        profile_complete = all(getattr(profile, field, None) for field in profile_fields)
        profile_complete = profile_complete and len(profile.personality) > 0 and len(profile.interests) > 0
        
        # ì´ìƒí˜• í”„ë¡œí•„ ì™„ì„±ë„ ì²´í¬
        ideal_type_complete = False
        if ideal_type:
            ideal_fields = ['height_min', 'height_max', 'age_min', 'age_max', 
                          'preferred_mbti', 'preferred_personality', 'preferred_interests']
            ideal_type_complete = all(getattr(ideal_type, field, None) for field in ideal_fields)
            ideal_type_complete = ideal_type_complete and \
                len(ideal_type.preferred_mbti) > 0 and \
                len(ideal_type.preferred_personality) > 0 and \
                len(ideal_type.preferred_interests) > 0
        
        return Response({
            'success': True,
            'profile_complete': profile_complete,
            'ideal_type_complete': ideal_type_complete,
            'all_complete': profile_complete and ideal_type_complete
        }, status=status.HTTP_200_OK)
    except User.DoesNotExist:
        return Response({
            'success': False,
            'profile_complete': False,
            'ideal_type_complete': False,
            'all_complete': False
        }, status=status.HTTP_200_OK)
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `get_profile` í•¨ìˆ˜ êµ¬í˜„
- [ ] `update_profile` í•¨ìˆ˜ êµ¬í˜„ (ìƒì„±/ìˆ˜ì •)
- [ ] `check_profile_completeness` í•¨ìˆ˜ êµ¬í˜„
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€

---

### 2-3. ë°±ì—”ë“œ: URL ì¶”ê°€

**íŒŒì¼**: `backend/apps/users/urls.py`

**ì‘ì—… ë‚´ìš©**:
```python
urlpatterns = [
    path('location/update/', views.update_location, name='update_location'),
    path('profile/', views.get_profile, name='get_profile'),
    path('profile/', views.update_profile, name='update_profile'),  # POST/PUT
    path('profile/completeness/', views.check_profile_completeness, name='check_profile_completeness'),
]
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] URL íŒ¨í„´ ì¶”ê°€
- [ ] ê²½ë¡œ í™•ì¸

---

### 2-4. í”„ë¡ íŠ¸ì—”ë“œ: API í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜ ì¶”ê°€

**íŒŒì¼**: `Frontend/IdealMatchApp/src/services/api/apiClient.js`

**ì‘ì—… ë‚´ìš©**:
```javascript
/**
 * í”„ë¡œí•„ ì¡°íšŒ
 * @returns {Promise<Object>} í”„ë¡œí•„ ì •ë³´
 */
async getProfile() {
  try {
    const response = await this.request('/users/profile/', {
      method: 'GET',
    });
    return {
      success: true,
      data: response.data,
    };
  } catch (error) {
    console.error('âŒ í”„ë¡œí•„ ì¡°íšŒ ì‹¤íŒ¨:', error);
    return {
      success: false,
      error: error.message,
    };
  }
}

/**
 * í”„ë¡œí•„ ìƒì„±/ìˆ˜ì •
 * @param {Object} profileData - í”„ë¡œí•„ ë°ì´í„°
 * @returns {Promise<Object>} ì €ì¥ ê²°ê³¼
 */
async updateProfile(profileData) {
  try {
    const response = await this.request('/users/profile/', {
      method: 'POST',  // ë˜ëŠ” PUT (ê¸°ì¡´ í”„ë¡œí•„ì´ ìˆìœ¼ë©´ PUT)
      body: JSON.stringify(profileData),
    });
    return {
      success: true,
      data: response.data,
    };
  } catch (error) {
    console.error('âŒ í”„ë¡œí•„ ì €ì¥ ì‹¤íŒ¨:', error);
    throw error;
  }
}

/**
 * í”„ë¡œí•„ ì™„ì„±ë„ í™•ì¸
 * @returns {Promise<Object>} ì™„ì„±ë„ ì •ë³´
 */
async checkProfileCompleteness() {
  try {
    const response = await this.request('/users/profile/completeness/', {
      method: 'GET',
    });
    return {
      success: true,
      ...response,
    };
  } catch (error) {
    console.error('âŒ í”„ë¡œí•„ ì™„ì„±ë„ í™•ì¸ ì‹¤íŒ¨:', error);
    return {
      success: false,
      error: error.message,
    };
  }
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `getProfile` í•¨ìˆ˜ ì¶”ê°€
- [ ] `updateProfile` í•¨ìˆ˜ ì¶”ê°€
- [ ] `checkProfileCompleteness` í•¨ìˆ˜ ì¶”ê°€

---

### 2-5. í”„ë¡ íŠ¸ì—”ë“œ: AuthContext ì—°ë™

**íŒŒì¼**: `Frontend/IdealMatchApp/src/context/AuthContext.js`

**ì‘ì—… ë‚´ìš©**:
```javascript
import { apiClient } from '../services/api';

// ê¸°ì¡´ updateProfile í•¨ìˆ˜ ìˆ˜ì •
const updateProfile = async (profile) => {
  try {
    if (!currentUser?.userId) {
      throw new Error('ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.');
    }
    
    // ì‹¤ì œ API í˜¸ì¶œ
    const result = await apiClient.updateProfile(profile);
    
    if (!result.success) {
      throw new Error(result.error || 'í”„ë¡œí•„ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
    
    // ë¡œì»¬ ì €ì¥ì†Œì—ë„ ì €ì¥ (ì„ íƒì‚¬í•­)
    await StorageService.saveUserProfile(profile, currentUser.userId);
    setUserProfile(profile);
    
    console.log('âœ… í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
  } catch (error) {
    console.error('Update profile error:', error);
    throw error;
  }
};

// í”„ë¡œí•„ ì¡°íšŒ í•¨ìˆ˜ ì¶”ê°€
const loadProfile = async () => {
  try {
    if (!currentUser?.userId) {
      return;
    }
    
    const result = await apiClient.getProfile();
    if (result.success && result.data) {
      setUserProfile(result.data);
      await StorageService.saveUserProfile(result.data, currentUser.userId);
    }
  } catch (error) {
    console.error('Load profile error:', error);
  }
};
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `updateProfile` í•¨ìˆ˜ ì‹¤ì œ API í˜¸ì¶œë¡œ ë³€ê²½
- [ ] `loadProfile` í•¨ìˆ˜ ì¶”ê°€
- [ ] ì•± ì‹œì‘ ì‹œ í”„ë¡œí•„ ìë™ ë¡œë“œ

---

### 2-6. í”„ë¡ íŠ¸ì—”ë“œ: í”„ë¡œí•„ í™”ë©´ ì—°ë™

**íŒŒì¼**: `Frontend/IdealMatchApp/src/screens/Profile/ProfileInputScreen.js`

**ì‘ì—… ë‚´ìš©**:
- ê¸°ì¡´ Mock API í˜¸ì¶œ ë¶€ë¶„ì„ `apiClient.updateProfile()`ë¡œ ë³€ê²½
- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ê°œì„ 
- ë¡œë”© ìƒíƒœ í‘œì‹œ

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] API í˜¸ì¶œ ë¡œì§ ìˆ˜ì •
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
- [ ] ì‹¤ì œ ì•±ì—ì„œ í…ŒìŠ¤íŠ¸

---

### Phase 2 ì™„ë£Œ ê¸°ì¤€

- [ ] í”„ë¡œí•„ ì¡°íšŒ API ì •ìƒ ì‘ë™
- [ ] í”„ë¡œí•„ ìƒì„±/ìˆ˜ì • API ì •ìƒ ì‘ë™
- [ ] í”„ë¡œí•„ ì™„ì„±ë„ í™•ì¸ API ì •ìƒ ì‘ë™
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í”„ë¡œí•„ ì €ì¥/ì¡°íšŒ ì •ìƒ ì‘ë™

---

## Phase 3: ì´ìƒí˜• í”„ë¡œí•„ ì‹œìŠ¤í…œ ì™„ì„± â­â­â­â­

**ëª©í‘œ**: ì´ìƒí˜• í”„ë¡œí•„ ì¡°íšŒ, ìƒì„±, ìˆ˜ì • ê¸°ëŠ¥ ì™„ì„±

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 2-3ì‹œê°„

### 3-1. ë°±ì—”ë“œ: IdealTypeProfileSerializer ìƒì„±

**íŒŒì¼**: `backend/apps/users/serializers.py`

**ì‘ì—… ë‚´ìš©**:
```python
from .models import IdealTypeProfile

class IdealTypeProfileSerializer(serializers.ModelSerializer):
    class Meta:
        model = IdealTypeProfile
        fields = ['height_min', 'height_max', 'age_min', 'age_max', 
                 'preferred_mbti', 'preferred_personality', 'preferred_interests', 
                 'match_threshold']
        read_only_fields = ['created_at', 'updated_at']
    
    def validate(self, data):
        # í‚¤ ë²”ìœ„ ê²€ì¦
        if data.get('height_min') and data.get('height_max'):
            if data['height_min'] > data['height_max']:
                raise serializers.ValidationError({
                    'height': 'ìµœì†Œ í‚¤ëŠ” ìµœëŒ€ í‚¤ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.'
                })
        
        # ë‚˜ì´ ë²”ìœ„ ê²€ì¦
        if data.get('age_min') and data.get('age_max'):
            if data['age_min'] > data['age_max']:
                raise serializers.ValidationError({
                    'age': 'ìµœì†Œ ë‚˜ì´ëŠ” ìµœëŒ€ ë‚˜ì´ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.'
                })
        
        # ì„ í˜¸ MBTI ê²€ì¦
        if data.get('preferred_mbti') and len(data['preferred_mbti']) == 0:
            raise serializers.ValidationError({
                'preferred_mbti': 'ì„ í˜¸ MBTIë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.'
            })
        
        # ì„ í˜¸ ì„±ê²© ê²€ì¦
        if data.get('preferred_personality') and len(data['preferred_personality']) == 0:
            raise serializers.ValidationError({
                'preferred_personality': 'ì„ í˜¸ ì„±ê²© ìœ í˜•ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.'
            })
        
        # ì„ í˜¸ ê´€ì‹¬ì‚¬ ê²€ì¦
        if data.get('preferred_interests') and len(data['preferred_interests']) == 0:
            raise serializers.ValidationError({
                'preferred_interests': 'ì„ í˜¸ ê´€ì‹¬ì‚¬ë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.'
            })
        
        return data
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `IdealTypeProfileSerializer` í´ë˜ìŠ¤ ìƒì„±
- [ ] ë²”ìœ„ ê²€ì¦ ë¡œì§ ì¶”ê°€
- [ ] í•„ìˆ˜ í•„ë“œ ê²€ì¦ ì¶”ê°€

---

### 3-2. ë°±ì—”ë“œ: ì´ìƒí˜• í”„ë¡œí•„ View êµ¬í˜„

**íŒŒì¼**: `backend/apps/users/views.py`

**ì‘ì—… ë‚´ìš©**:
```python
from .models import IdealTypeProfile
from .serializers import IdealTypeProfileSerializer

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_ideal_type(request):
    try:
        ideal_type = request.user.profile.ideal_type_profile
        serializer = IdealTypeProfileSerializer(ideal_type)
        return Response({
            'success': True,
            'data': serializer.data
        }, status=status.HTTP_200_OK)
    except (User.DoesNotExist, IdealTypeProfile.DoesNotExist):
        return Response({
            'success': False,
            'message': 'ì´ìƒí˜• í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.'
        }, status=status.HTTP_404_NOT_FOUND)

@api_view(['POST', 'PUT'])
@permission_classes([IsAuthenticated])
def update_ideal_type(request):
    try:
        profile = request.user.profile
        ideal_type = profile.ideal_type_profile
        serializer = IdealTypeProfileSerializer(ideal_type, data=request.data, partial=request.method == 'PUT')
    except (User.DoesNotExist, IdealTypeProfile.DoesNotExist):
        # ì´ìƒí˜• í”„ë¡œí•„ì´ ì—†ìœ¼ë©´ ìƒì„±
        serializer = IdealTypeProfileSerializer(data=request.data)
    
    if serializer.is_valid():
        if hasattr(request.user, 'profile'):
            serializer.save(user=request.user.profile)
        else:
            # User í”„ë¡œí•„ì´ ì—†ìœ¼ë©´ ë¨¼ì € ìƒì„±í•´ì•¼ í•¨
            return Response({
                'success': False,
                'message': 'ë¨¼ì € í”„ë¡œí•„ì„ ìƒì„±í•´ì£¼ì„¸ìš”.'
            }, status=status.HTTP_400_BAD_REQUEST)
        
        return Response({
            'success': True,
            'message': 'ì´ìƒí˜• í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.',
            'data': serializer.data
        }, status=status.HTTP_200_OK)
    return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `get_ideal_type` í•¨ìˆ˜ êµ¬í˜„
- [ ] `update_ideal_type` í•¨ìˆ˜ êµ¬í˜„
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€

---

### 3-3. ë°±ì—”ë“œ: URL ì¶”ê°€

**íŒŒì¼**: `backend/apps/users/urls.py`

**ì‘ì—… ë‚´ìš©**:
```python
urlpatterns = [
    # ... ê¸°ì¡´ URLë“¤
    path('ideal-type/', views.get_ideal_type, name='get_ideal_type'),
    path('ideal-type/', views.update_ideal_type, name='update_ideal_type'),  # POST/PUT
]
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] URL íŒ¨í„´ ì¶”ê°€

---

### 3-4. í”„ë¡ íŠ¸ì—”ë“œ: API í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜ ì¶”ê°€

**íŒŒì¼**: `Frontend/IdealMatchApp/src/services/api/apiClient.js`

**ì‘ì—… ë‚´ìš©**:
```javascript
/**
 * ì´ìƒí˜• í”„ë¡œí•„ ì¡°íšŒ
 * @returns {Promise<Object>} ì´ìƒí˜• í”„ë¡œí•„ ì •ë³´
 */
async getIdealType() {
  try {
    const response = await this.request('/users/ideal-type/', {
      method: 'GET',
    });
    return {
      success: true,
      data: response.data,
    };
  } catch (error) {
    console.error('âŒ ì´ìƒí˜• í”„ë¡œí•„ ì¡°íšŒ ì‹¤íŒ¨:', error);
    return {
      success: false,
      error: error.message,
    };
  }
}

/**
 * ì´ìƒí˜• í”„ë¡œí•„ ìƒì„±/ìˆ˜ì •
 * @param {Object} idealTypeData - ì´ìƒí˜• í”„ë¡œí•„ ë°ì´í„°
 * @returns {Promise<Object>} ì €ì¥ ê²°ê³¼
 */
async updateIdealType(idealTypeData) {
  try {
    const response = await this.request('/users/ideal-type/', {
      method: 'POST',
      body: JSON.stringify(idealTypeData),
    });
    return {
      success: true,
      data: response.data,
    };
  } catch (error) {
    console.error('âŒ ì´ìƒí˜• í”„ë¡œí•„ ì €ì¥ ì‹¤íŒ¨:', error);
    throw error;
  }
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `getIdealType` í•¨ìˆ˜ ì¶”ê°€
- [ ] `updateIdealType` í•¨ìˆ˜ ì¶”ê°€

---

### 3-5. í”„ë¡ íŠ¸ì—”ë“œ: AuthContext ì—°ë™

**íŒŒì¼**: `Frontend/IdealMatchApp/src/context/AuthContext.js`

**ì‘ì—… ë‚´ìš©**:
- `updateIdealType` í•¨ìˆ˜ë¥¼ ì‹¤ì œ API í˜¸ì¶œë¡œ ë³€ê²½
- `loadIdealType` í•¨ìˆ˜ ì¶”ê°€

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ì‹¤ì œ API í˜¸ì¶œë¡œ ë³€ê²½
- [ ] ì•± ì‹œì‘ ì‹œ ì´ìƒí˜• í”„ë¡œí•„ ìë™ ë¡œë“œ

---

### 3-6. í”„ë¡ íŠ¸ì—”ë“œ: ì´ìƒí˜• í”„ë¡œí•„ í™”ë©´ ì—°ë™

**íŒŒì¼**: `Frontend/IdealMatchApp/src/screens/IdealType/IdealTypeInputScreen.js`

**ì‘ì—… ë‚´ìš©**:
- Mock API í˜¸ì¶œ ë¶€ë¶„ì„ `apiClient.updateIdealType()`ë¡œ ë³€ê²½

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] API í˜¸ì¶œ ë¡œì§ ìˆ˜ì •
- [ ] ì‹¤ì œ ì•±ì—ì„œ í…ŒìŠ¤íŠ¸

---

### Phase 3 ì™„ë£Œ ê¸°ì¤€

- [ ] ì´ìƒí˜• í”„ë¡œí•„ ì¡°íšŒ/ìƒì„±/ìˆ˜ì • API ì •ìƒ ì‘ë™
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ìƒí˜• í”„ë¡œí•„ ì €ì¥/ì¡°íšŒ ì •ìƒ ì‘ë™

---

## Phase 4: ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ & ì‹œìŠ¤í…œ ì™„ì„± â­â­â­â­â­

**ëª©í‘œ**: ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„ ë° ë§¤ì¹­ ì²´í¬ ê¸°ëŠ¥ ì™„ì„±

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 4-6ì‹œê°„ (ê°€ì¥ ë³µì¡)

### 4-1. ë°±ì—”ë“œ: ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ êµ¬í˜„

**íŒŒì¼**: `backend/apps/matching/utils.py` (ìƒˆ íŒŒì¼ ìƒì„±)

**ì‘ì—… ë‚´ìš©**:
```python
from math import radians, sin, cos, sqrt, atan2

def calculate_distance(lat1, lon1, lat2, lon2):
    """
    í•˜ë²„ì‚¬ì¸ ê³µì‹ìœ¼ë¡œ ë‘ ì§€ì  ê°„ ê±°ë¦¬ ê³„ì‚° (km ë‹¨ìœ„)
    """
    R = 6371  # ì§€êµ¬ ë°˜ì§€ë¦„ (km)
    
    lat1_rad = radians(float(lat1))
    lon1_rad = radians(float(lon1))
    lat2_rad = radians(float(lat2))
    lon2_rad = radians(float(lon2))
    
    dlat = lat2_rad - lat1_rad
    dlon = lon2_rad - lon1_rad
    
    a = sin(dlat/2)**2 + cos(lat1_rad) * cos(lat2_rad) * sin(dlon/2)**2
    c = 2 * atan2(sqrt(a), sqrt(1-a))
    
    distance = R * c
    return distance

def get_users_within_radius(latitude, longitude, radius_km):
    """
    ë°˜ê²½ ë‚´ ì‚¬ìš©ì ì¡°íšŒ
    """
    from apps.users.models import User, UserLocation
    
    # ëª¨ë“  í™œì„± ì‚¬ìš©ì ìœ„ì¹˜ ì¡°íšŒ
    locations = UserLocation.objects.select_related('user').all()
    
    nearby_users = []
    for location in locations:
        distance = calculate_distance(
            latitude, longitude,
            location.latitude, location.longitude
        )
        if distance <= radius_km:
            nearby_users.append({
                'user': location.user,
                'distance': distance,
                'location': location
            })
    
    return nearby_users
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `calculate_distance` í•¨ìˆ˜ êµ¬í˜„
- [ ] `get_users_within_radius` í•¨ìˆ˜ êµ¬í˜„
- [ ] í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± (ì„ íƒì‚¬í•­)

---

### 4-2. ë°±ì—”ë“œ: ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„

**íŒŒì¼**: `backend/apps/matching/utils.py`

**ì‘ì—… ë‚´ìš©**:
```python
from apps.users.models import User, IdealTypeProfile

def check_match_criteria(ideal_type, target_user, match_threshold=3):
    """
    ì´ìƒí˜• ì¡°ê±´ê³¼ ëŒ€ìƒ ì‚¬ìš©ì ë§¤ì¹­ ì²´í¬
    ë°˜í™˜: (ë§¤ì¹­ ì ìˆ˜, ë§¤ì¹­ëœ ì¡°ê±´ ë¦¬ìŠ¤íŠ¸)
    """
    score = 0
    matched_criteria = []
    
    # ì¡°ê±´ 1: í‚¤ ë²”ìœ„ ì²´í¬
    if ideal_type.height_min <= target_user.height <= ideal_type.height_max:
        score += 1
        matched_criteria.append('height')
    
    # ì¡°ê±´ 2: ë‚˜ì´ ë²”ìœ„ ì²´í¬
    if ideal_type.age_min <= target_user.age <= ideal_type.age_max:
        score += 1
        matched_criteria.append('age')
    
    # ì¡°ê±´ 3: MBTI ì²´í¬
    if target_user.mbti in ideal_type.preferred_mbti:
        score += 1
        matched_criteria.append('mbti')
    
    # ì¡°ê±´ 4: ì„±ê²© êµì§‘í•© ì²´í¬
    personality_match = set(target_user.personality) & set(ideal_type.preferred_personality)
    if len(personality_match) > 0:
        score += 1
        matched_criteria.append('personality')
    
    # ì¡°ê±´ 5: ê´€ì‹¬ì‚¬ êµì§‘í•© ì²´í¬
    interest_match = set(target_user.interests) & set(ideal_type.preferred_interests)
    if len(interest_match) > 0:
        score += 1
        matched_criteria.append('interests')
    
    return score, matched_criteria

def find_matches(user, latitude, longitude, radius_km=0.05):
    """
    ì‚¬ìš©ìì— ëŒ€í•œ ë§¤ì¹­ í›„ë³´ ì°¾ê¸°
    """
    from apps.matching.utils import get_users_within_radius, check_match_criteria
    
    # í”„ë¡œí•„ê³¼ ì´ìƒí˜• í”„ë¡œí•„ í™•ì¸
    try:
        profile = user
        ideal_type = profile.ideal_type_profile
    except (AttributeError, IdealTypeProfile.DoesNotExist):
        return []
    
    # ë§¤ì¹­ ë™ì˜ ë° ì„œë¹„ìŠ¤ í™œì„±í™” í™•ì¸
    if not profile.matching_consent or not profile.service_active:
        return []
    
    # ë°˜ê²½ ë‚´ ì‚¬ìš©ì ì¡°íšŒ
    nearby_users_data = get_users_within_radius(latitude, longitude, radius_km)
    
    matches = []
    for user_data in nearby_users_data:
        target_user = user_data['user']
        
        # ìê¸° ìì‹  ì œì™¸
        if target_user.id == profile.id:
            continue
        
        # ëŒ€ìƒ ì‚¬ìš©ìë„ ë™ì˜ ë° í™œì„±í™” í™•ì¸
        if not target_user.matching_consent or not target_user.service_active:
            continue
        
        # ëŒ€ìƒ ì‚¬ìš©ìì˜ ì´ìƒí˜• í”„ë¡œí•„ í™•ì¸
        try:
            target_ideal_type = target_user.ideal_type_profile
        except IdealTypeProfile.DoesNotExist:
            continue
        
        # ì–‘ë°©í–¥ ë§¤ì¹­ ì²´í¬
        score1, criteria1 = check_match_criteria(ideal_type, target_user, ideal_type.match_threshold)
        score2, criteria2 = check_match_criteria(target_ideal_type, profile, target_ideal_type.match_threshold)
        
        # ì–‘ìª½ ëª¨ë‘ ì„ê³„ê°’ ì´ìƒì´ë©´ ë§¤ì¹­ ì„±ê³µ
        if score1 >= ideal_type.match_threshold and score2 >= target_ideal_type.match_threshold:
            matches.append({
                'target_user': target_user,
                'distance': user_data['distance'],
                'score': score1,
                'matched_criteria': criteria1,
                'mutual_score': score2,
            })
    
    # ì ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬
    matches.sort(key=lambda x: (x['score'], -x['distance']), reverse=True)
    
    return matches
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `check_match_criteria` í•¨ìˆ˜ êµ¬í˜„
- [ ] `find_matches` í•¨ìˆ˜ êµ¬í˜„
- [ ] ì–‘ë°©í–¥ ë§¤ì¹­ ë¡œì§ êµ¬í˜„
- [ ] í•„í„°ë§ ë¡œì§ êµ¬í˜„ (ë™ì˜, í™œì„±í™”)

---

### 4-3. ë°±ì—”ë“œ: ë§¤ì¹­ View êµ¬í˜„

**íŒŒì¼**: `backend/apps/matching/views.py` (ìƒˆ íŒŒì¼ ë˜ëŠ” ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •)

**ì‘ì—… ë‚´ìš©**:
```python
from rest_framework.decorators import api_view, permission_classes
from rest_framework.permissions import IsAuthenticated
from rest_framework.response import Response
from rest_framework import status
from apps.users.models import User
from apps.matching.models import Match
from apps.matching.utils import find_matches
from django.utils import timezone

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_matchable_count(request):
    """
    ë§¤ì¹­ ê°€ëŠ¥ ì¸ì› ìˆ˜ ì¡°íšŒ
    """
    latitude = float(request.query_params.get('latitude'))
    longitude = float(request.query_params.get('longitude'))
    radius = float(request.query_params.get('radius', 0.05))  # ê¸°ë³¸ 50m
    
    try:
        profile = request.user.profile
        matches = find_matches(profile, latitude, longitude, radius)
        
        return Response({
            'success': True,
            'count': len(matches),
            'radius_km': radius
        }, status=status.HTTP_200_OK)
    except Exception as e:
        return Response({
            'success': False,
            'error': str(e)
        }, status=status.HTTP_400_BAD_REQUEST)

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def check_matches(request):
    """
    ë§¤ì¹­ ì²´í¬ (í¬ê·¸ë¼ìš´ë“œ)
    """
    try:
        profile = request.user.profile
        
        # í˜„ì¬ ìœ„ì¹˜ ì¡°íšŒ
        location = profile.location
        if not location:
            return Response({
                'success': False,
                'message': 'ìœ„ì¹˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'
            }, status=status.HTTP_400_BAD_REQUEST)
        
        # ë§¤ì¹­ ì°¾ê¸°
        matches = find_matches(
            profile,
            float(location.latitude),
            float(location.longitude),
            radius_km=0.05
        )
        
        # ìƒˆ ë§¤ì¹­ì´ ìˆëŠ”ì§€ í™•ì¸ (ì¤‘ë³µ ë°©ì§€)
        new_matches = []
        for match_data in matches:
            target_user = match_data['target_user']
            
            # ì´ë¯¸ ë§¤ì¹­ëœ ì‚¬ìš©ìì¸ì§€ í™•ì¸
            existing_match = Match.objects.filter(
                user1=profile, user2=target_user
            ).first() or Match.objects.filter(
                user1=target_user, user2=profile
            ).first()
            
            if not existing_match:
                # ìƒˆ ë§¤ì¹­ ìƒì„±
                match = Match.objects.create(
                    user1=profile,
                    user2=target_user,
                    user1_latitude=location.latitude,
                    user1_longitude=location.longitude,
                    user2_latitude=target_user.location.latitude,
                    user2_longitude=target_user.location.longitude,
                    matched_criteria=match_data['matched_criteria']
                )
                
                # ì•Œë¦¼ ìƒì„± (Phase 6ì—ì„œ êµ¬í˜„)
                # create_notification(profile, match)
                
                new_matches.append({
                    'match_id': match.id,
                    'target_user_id': target_user.id,
                    'matched_criteria': match_data['matched_criteria'],
                    'score': match_data['score']
                })
        
        return Response({
            'success': True,
            'has_new_match': len(new_matches) > 0,
            'new_matches': new_matches,
            'total_count': len(matches)
        }, status=status.HTTP_200_OK)
        
    except Exception as e:
        return Response({
            'success': False,
            'error': str(e)
        }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `get_matchable_count` í•¨ìˆ˜ êµ¬í˜„
- [ ] `check_matches` í•¨ìˆ˜ êµ¬í˜„
- [ ] ì¤‘ë³µ ë§¤ì¹­ ë°©ì§€ ë¡œì§
- [ ] Match ëª¨ë¸ ìƒì„± ë¡œì§

---

### 4-4. ë°±ì—”ë“œ: ë§¤ì¹­ URL ì¶”ê°€

**íŒŒì¼**: `backend/apps/matching/urls.py`

**ì‘ì—… ë‚´ìš©**:
```python
from django.urls import path
from . import views

app_name = 'matching'

urlpatterns = [
    path('matchable-count/', views.get_matchable_count, name='matchable_count'),
    path('check/', views.check_matches, name='check_matches'),
]
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] URL íŒ¨í„´ ì¶”ê°€
- [ ] ê²½ë¡œ í™•ì¸: `/api/matching/matchable-count/`, `/api/matching/check/`

---

### 4-5. í”„ë¡ íŠ¸ì—”ë“œ: API í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜ ì¶”ê°€

**íŒŒì¼**: `Frontend/IdealMatchApp/src/services/api/apiClient.js`

**ì‘ì—… ë‚´ìš©**:
```javascript
/**
 * ë§¤ì¹­ ê°€ëŠ¥ ì¸ì› ìˆ˜ ì¡°íšŒ
 * @param {number} latitude - ìœ„ë„
 * @param {number} longitude - ê²½ë„
 * @param {number} radius - ë°˜ê²½ (km, ê¸°ë³¸ê°’: 0.05)
 * @returns {Promise<Object>} ì¸ì› ìˆ˜
 */
async getMatchableCount(latitude, longitude, radius = 0.05) {
  try {
    const response = await this.request(
      `/matching/matchable-count/?latitude=${latitude}&longitude=${longitude}&radius=${radius}`,
      {
        method: 'GET',
      }
    );
    return {
      success: true,
      count: response.count,
    };
  } catch (error) {
    console.error('âŒ ë§¤ì¹­ ê°€ëŠ¥ ì¸ì› ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', error);
    return {
      success: false,
      error: error.message,
    };
  }
}

/**
 * ë§¤ì¹­ ì²´í¬
 * @returns {Promise<Object>} ë§¤ì¹­ ê²°ê³¼
 */
async checkMatches() {
  try {
    const response = await this.request('/matching/check/', {
      method: 'GET',
    });
    return {
      success: true,
      hasNewMatch: response.has_new_match,
      newMatches: response.new_matches || [],
    };
  } catch (error) {
    console.error('âŒ ë§¤ì¹­ ì²´í¬ ì‹¤íŒ¨:', error);
    return {
      success: false,
      error: error.message,
    };
  }
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `getMatchableCount` í•¨ìˆ˜ ì¶”ê°€
- [ ] `checkMatches` í•¨ìˆ˜ ì¶”ê°€

---

### 4-6. í”„ë¡ íŠ¸ì—”ë“œ: ë©”ì¸ í™”ë©´ ì—°ë™

**íŒŒì¼**: `Frontend/IdealMatchApp/src/screens/Main/MainScreen.js`

**ì‘ì—… ë‚´ìš©**:
- ë§¤ì¹­ ê°€ëŠ¥ ì¸ì› ìˆ˜ í‘œì‹œ
- ì£¼ê¸°ì  ë§¤ì¹­ ì²´í¬ (10ì´ˆë§ˆë‹¤)
- ìƒˆ ë§¤ì¹­ ë°œê²¬ ì‹œ ì•Œë¦¼ í‘œì‹œ

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ë§¤ì¹­ ê°€ëŠ¥ ì¸ì› ìˆ˜ í‘œì‹œ
- [ ] ì£¼ê¸°ì  ë§¤ì¹­ ì²´í¬ êµ¬í˜„
- [ ] ìƒˆ ë§¤ì¹­ ë°œê²¬ ì‹œ ì²˜ë¦¬

---

### Phase 4 ì™„ë£Œ ê¸°ì¤€

- [ ] ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ì´ ì •ìƒ ì‘ë™
- [ ] ë§¤ì¹­ ê°€ëŠ¥ ì¸ì› ìˆ˜ ì¡°íšŒ ì •ìƒ ì‘ë™
- [ ] ë§¤ì¹­ ì²´í¬ ì •ìƒ ì‘ë™
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë§¤ì¹­ ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™

---

## Phase 5: ì„œë¹„ìŠ¤ ì„¤ì • ê¸°ëŠ¥ ì™„ì„± â­â­â­

**ëª©í‘œ**: ë§¤ì¹­ ë™ì˜ ON/OFF ê¸°ëŠ¥ ì™„ì„±

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 1ì‹œê°„

### 5-1. ë°±ì—”ë“œ: ë™ì˜ ì—…ë°ì´íŠ¸ View êµ¬í˜„

**íŒŒì¼**: `backend/apps/users/views.py`

**ì‘ì—… ë‚´ìš©**:
```python
@api_view(['POST'])
@permission_classes([IsAuthenticated])
def update_consent(request):
    """
    ë§¤ì¹­ ë™ì˜ ë° ì„œë¹„ìŠ¤ í™œì„±í™” ì—…ë°ì´íŠ¸
    """
    matching_consent = request.data.get('matching_consent')
    service_active = request.data.get('service_active')
    
    try:
        profile = request.user.profile
        
        if matching_consent is not None:
            profile.matching_consent = matching_consent
            profile.consent_updated_at = timezone.now()
        
        if service_active is not None:
            profile.service_active = service_active
        
        profile.save()
        
        return Response({
            'success': True,
            'message': 'ì„¤ì •ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.',
            'data': {
                'matching_consent': profile.matching_consent,
                'service_active': profile.service_active
            }
        }, status=status.HTTP_200_OK)
    except User.DoesNotExist:
        return Response({
            'success': False,
            'message': 'í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.'
        }, status=status.HTTP_404_NOT_FOUND)
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `update_consent` í•¨ìˆ˜ êµ¬í˜„
- [ ] URL ì¶”ê°€

---

### 5-2. í”„ë¡ íŠ¸ì—”ë“œ: API í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜ ì¶”ê°€

**íŒŒì¼**: `Frontend/IdealMatchApp/src/services/api/apiClient.js`

**ì‘ì—… ë‚´ìš©**:
```javascript
/**
 * ë§¤ì¹­ ë™ì˜ ì—…ë°ì´íŠ¸
 * @param {boolean} matchingConsent - ë§¤ì¹­ ë™ì˜ ì—¬ë¶€
 * @param {boolean} serviceActive - ì„œë¹„ìŠ¤ í™œì„±í™” ì—¬ë¶€
 * @returns {Promise<Object>} ì—…ë°ì´íŠ¸ ê²°ê³¼
 */
async updateConsent(matchingConsent, serviceActive) {
  try {
    const response = await this.request('/users/consent/', {
      method: 'POST',
      body: JSON.stringify({
        matching_consent: matchingConsent,
        service_active: serviceActive,
      }),
    });
    return {
      success: true,
      data: response.data,
    };
  } catch (error) {
    console.error('âŒ ë™ì˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
    throw error;
  }
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `updateConsent` í•¨ìˆ˜ ì¶”ê°€

---

### 5-3. í”„ë¡ íŠ¸ì—”ë“œ: ë©”ì¸ í™”ë©´ì— ë™ì˜ í† ê¸€ ì¶”ê°€

**íŒŒì¼**: `Frontend/IdealMatchApp/src/screens/Main/MainScreen.js`

**ì‘ì—… ë‚´ìš©**:
- ì„œë¹„ìŠ¤ í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€ ë²„íŠ¼ ì¶”ê°€
- ë™ì˜ ìƒíƒœì— ë”°ë¼ ìœ„ì¹˜ ì „ì†¡/ë§¤ì¹­ ì²´í¬ ì œì–´

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] í† ê¸€ ë²„íŠ¼ ì¶”ê°€
- [ ] ë™ì˜ ìƒíƒœì— ë”°ë¥¸ ë¡œì§ êµ¬í˜„

---

### Phase 5 ì™„ë£Œ ê¸°ì¤€

- [ ] ë§¤ì¹­ ë™ì˜ ON/OFF ê¸°ëŠ¥ ì •ìƒ ì‘ë™
- [ ] ë™ì˜ ìƒíƒœì— ë”°ë¼ ìœ„ì¹˜ ì „ì†¡/ë§¤ì¹­ ì²´í¬ ì œì–´

---

## Phase 6: ì•Œë¦¼ ì‹œìŠ¤í…œ ì™„ì„± â­â­â­

**ëª©í‘œ**: ì•Œë¦¼ ìƒì„± ë° ì¡°íšŒ ê¸°ëŠ¥ ì™„ì„±

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 2-3ì‹œê°„

### 6-1. ë°±ì—”ë“œ: ì•Œë¦¼ View êµ¬í˜„

**íŒŒì¼**: `backend/apps/matching/views.py`

**ì‘ì—… ë‚´ìš©**:
```python
from apps.matching.models import Notification

def create_notification(user, match):
    """
    ë§¤ì¹­ ì‹œ ì•Œë¦¼ ìƒì„± (ì¤‘ë³µ ë°©ì§€)
    """
    # 5ë¶„ ë‚´ ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€
    from datetime import timedelta
    recent_notification = Notification.objects.filter(
        user=user,
        match=match,
        boundary_entered_at__gte=timezone.now() - timedelta(minutes=5)
    ).first()
    
    if recent_notification:
        return recent_notification
    
    # ìƒˆ ì•Œë¦¼ ìƒì„±
    notification = Notification.objects.create(
        user=user,
        match=match,
        boundary_entered_at=timezone.now(),
        is_active=True
    )
    
    return notification

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_notifications(request):
    """
    ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ
    """
    try:
        profile = request.user.profile
        notifications = Notification.objects.filter(
            user=profile
        ).select_related('match').order_by('-boundary_entered_at')
        
        notifications_data = []
        for notification in notifications:
            # ë§¤ì¹­ëœ ìƒëŒ€ë°© ì •ë³´
            other_user = notification.match.user1 if notification.match.user1 != profile else notification.match.user2
            
            notifications_data.append({
                'id': notification.id,
                'match_id': notification.match.id,
                'target_user': {
                    'id': other_user.id,
                    # í•„ìš”í•œ ì‚¬ìš©ì ì •ë³´ë§Œ í¬í•¨
                },
                'matched_criteria': notification.match.matched_criteria,
                'matched_at': notification.match.matched_at,
                'is_active': notification.is_active,
            })
        
        return Response({
            'success': True,
            'data': notifications_data
        }, status=status.HTTP_200_OK)
    except Exception as e:
        return Response({
            'success': False,
            'error': str(e)
        }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `create_notification` í•¨ìˆ˜ êµ¬í˜„ (ì¤‘ë³µ ë°©ì§€ í¬í•¨)
- [ ] `get_notifications` í•¨ìˆ˜ êµ¬í˜„
- [ ] ë§¤ì¹­ ì²´í¬ ì‹œ ì•Œë¦¼ ìƒì„± ë¡œì§ ì¶”ê°€

---

### 6-2. ë°±ì—”ë“œ: ë§¤ì¹­ ì²´í¬ì— ì•Œë¦¼ ìƒì„± ì¶”ê°€

**íŒŒì¼**: `backend/apps/matching/views.py`

**ì‘ì—… ë‚´ìš©**:
- `check_matches` í•¨ìˆ˜ì—ì„œ ìƒˆ ë§¤ì¹­ ë°œê²¬ ì‹œ `create_notification` í˜¸ì¶œ

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ì•Œë¦¼ ìƒì„± ë¡œì§ ì¶”ê°€

---

### 6-3. í”„ë¡ íŠ¸ì—”ë“œ: API í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜ ì¶”ê°€

**íŒŒì¼**: `Frontend/IdealMatchApp/src/services/api/apiClient.js`

**ì‘ì—… ë‚´ìš©**:
```javascript
/**
 * ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ
 * @returns {Promise<Object>} ì•Œë¦¼ ëª©ë¡
 */
async getNotifications() {
  try {
    const response = await this.request('/notifications/', {
      method: 'GET',
    });
    return {
      success: true,
      data: response.data,
    };
  } catch (error) {
    console.error('âŒ ì•Œë¦¼ ì¡°íšŒ ì‹¤íŒ¨:', error);
    return {
      success: false,
      error: error.message,
    };
  }
}
```

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `getNotifications` í•¨ìˆ˜ ì¶”ê°€

---

### 6-4. í”„ë¡ íŠ¸ì—”ë“œ: ì•Œë¦¼ í™”ë©´ êµ¬í˜„

**íŒŒì¼**: `Frontend/IdealMatchApp/src/screens/Notification/` (ìƒˆë¡œ ìƒì„±)

**ì‘ì—… ë‚´ìš©**:
- ì•Œë¦¼ ëª©ë¡ í™”ë©´ êµ¬í˜„
- ë§¤ì¹­ëœ ì¡°ê±´ ì •ë³´ í‘œì‹œ

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ì•Œë¦¼ ëª©ë¡ í™”ë©´ êµ¬í˜„
- [ ] ë„¤ë¹„ê²Œì´ì…˜ ì—°ê²°

---

### Phase 6 ì™„ë£Œ ê¸°ì¤€

- [ ] ì•Œë¦¼ ìƒì„± ì •ìƒ ì‘ë™
- [ ] ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ ì •ìƒ ì‘ë™
- [ ] ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€ ì •ìƒ ì‘ë™
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì•Œë¦¼ í™”ë©´ ì •ìƒ ì‘ë™

---

## Phase 7: í†µí•© í…ŒìŠ¤íŠ¸ & ìµœì¢… ì ê²€ â­â­â­â­â­

**ëª©í‘œ**: ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸ ë° ë²„ê·¸ ìˆ˜ì •

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 2-4ì‹œê°„

### 7-1. ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
1. íšŒì›ê°€ì… â†’ ë¡œê·¸ì¸
2. í”„ë¡œí•„ ì…ë ¥
3. ì´ìƒí˜• í”„ë¡œí•„ ì…ë ¥
4. ì„œë¹„ìŠ¤ í™œì„±í™”
5. ìœ„ì¹˜ ì „ì†¡ í™•ì¸
6. ë§¤ì¹­ ì²´í¬ í™•ì¸
7. ì•Œë¦¼ í™•ì¸

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] ì „ì²´ í”Œë¡œìš° ì •ìƒ ì‘ë™
- [ ] ì—ëŸ¬ ì¼€ì´ìŠ¤ ì²˜ë¦¬ í™•ì¸
- [ ] ì—ì§€ ì¼€ì´ìŠ¤ í™•ì¸

---

### 7-2. ë²„ê·¸ ìˆ˜ì •

**ì‘ì—… ë‚´ìš©**:
- ë°œê²¬ëœ ë²„ê·¸ ìˆ˜ì •
- ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ 
- ë¡œë”© ìƒíƒœ ê°œì„ 

---

### 7-3. ì„±ëŠ¥ ìµœì í™” (ì„ íƒì‚¬í•­)

**ì‘ì—… ë‚´ìš©**:
- ì¿¼ë¦¬ ìµœì í™”
- API ì‘ë‹µ ì‹œê°„ í™•ì¸
- í”„ë¡ íŠ¸ì—”ë“œ ë Œë”ë§ ìµœì í™”

---

### Phase 7 ì™„ë£Œ ê¸°ì¤€

- [ ] ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ì£¼ìš” ë²„ê·¸ ìˆ˜ì • ì™„ë£Œ
- [ ] ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

---

## ğŸ“ ì‘ì—… ì‹œ ì£¼ì˜ì‚¬í•­

### 1. ìˆœì„œ ì¤€ìˆ˜
- ê° PhaseëŠ” ìˆœì„œëŒ€ë¡œ ì§„í–‰ (ì˜ì¡´ì„± ìˆìŒ)
- Phase ì™„ë£Œ í›„ ë‹¤ìŒ Phaseë¡œ ì§„í–‰

### 2. í…ŒìŠ¤íŠ¸ ì¤‘ìš”
- ê° Phase ì™„ë£Œ í›„ ë°˜ë“œì‹œ í…ŒìŠ¤íŠ¸
- ë°±ì—”ë“œ APIëŠ” Postman/curlë¡œ ë¨¼ì € í…ŒìŠ¤íŠ¸
- í”„ë¡ íŠ¸ì—”ë“œëŠ” ì‹¤ì œ ì•±ì—ì„œ í…ŒìŠ¤íŠ¸

### 3. ì—ëŸ¬ ì²˜ë¦¬
- ëª¨ë“  APIì— ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€
- ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€

### 4. ì½”ë“œ í’ˆì§ˆ
- í•¨ìˆ˜ë³„ ì£¼ì„ ì¶”ê°€
- ì¼ê´€ëœ ì½”ë“œ ìŠ¤íƒ€ì¼ ìœ ì§€

---

## ğŸ¯ ì „ì²´ ì˜ˆìƒ ì†Œìš” ì‹œê°„

- **Phase 1**: 1-2ì‹œê°„
- **Phase 2**: 2-3ì‹œê°„
- **Phase 3**: 2-3ì‹œê°„
- **Phase 4**: 4-6ì‹œê°„ (ê°€ì¥ ë³µì¡)
- **Phase 5**: 1ì‹œê°„
- **Phase 6**: 2-3ì‹œê°„
- **Phase 7**: 2-4ì‹œê°„

**ì´ ì˜ˆìƒ ì‹œê°„**: 14-22ì‹œê°„

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-01-15
