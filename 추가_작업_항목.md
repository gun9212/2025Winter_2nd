# 추가 작업 항목 (로그인 기능 제외)

로그인 기능을 제외하고 구현해야 할 모든 작업을 정리한 문서입니다.

---

## 📊 전체 진행 상황

### ✅ 완료된 작업
- [x] 데이터베이스 모델 정의 (User, IdealTypeProfile, UserLocation, Match, Notification)
- [x] 프론트엔드 기본 화면 구조 (로그인, 회원가입, 프로필, 이상형, 메인)
- [x] 위치 추적 서비스 (프론트엔드)
- [x] API 클라이언트 기본 구조 (위치 업데이트만 구현됨)
- [x] 인증번호 타이머 기능

### ❌ 미구현 작업

---

## 🔴 백엔드 API 구현 (높은 우선순위)

### 1. 위치 관련 API

#### 1-1. 위치 업데이트 API ✅ (부분 구현)
- **파일**: `backend/apps/users/views.py`, `serializers.py`
- **엔드포인트**: `POST /api/users/location/update/`
- **상태**: 프론트엔드에서 호출하는 코드는 있음, 백엔드 구현 필요
- **작업 내용**:
  - `UserLocationSerializer` 생성
  - `LocationUpdateView` 구현
  - JWT 인증 확인
  - UserLocation 모델 업데이트/생성 (upsert)

**우선순위**: ⭐⭐⭐⭐⭐ (가장 긴급)

---

### 2. 프로필 관리 API

#### 2-1. 프로필 조회 API
- **파일**: `backend/apps/users/views.py`, `serializers.py`
- **엔드포인트**: `GET /api/users/profile/`
- **작업 내용**:
  - `UserSerializer` 생성
  - `ProfileView` 구현 (GET)
  - JWT 인증 확인
  - 현재 로그인한 사용자의 프로필 반환

#### 2-2. 프로필 생성/수정 API
- **엔드포인트**: `POST/PUT /api/users/profile/`
- **작업 내용**:
  - `UserSerializer`에서 생성/수정 로직 구현
  - `ProfileView` 구현 (POST/PUT)
  - 유효성 검증 (age, gender, height, mbti, personality, interests)
  - 성격/관심사 최소 1개 이상 검증

#### 2-3. 프로필 완성도 확인 API
- **엔드포인트**: `GET /api/users/profile/completeness/`
- **작업 내용**:
  - 프로필과 이상형 프로필 완성도 확인
  - 모든 필수 필드 입력 여부 체크
  - 완성도 퍼센트 계산

**우선순위**: ⭐⭐⭐⭐

---

### 3. 이상형 프로필 API

#### 3-1. 이상형 프로필 조회 API
- **엔드포인트**: `GET /api/users/ideal-type/`
- **작업 내용**:
  - `IdealTypeProfileSerializer` 생성
  - `IdealTypeView` 구현 (GET)
  - 현재 사용자의 이상형 프로필 반환

#### 3-2. 이상형 프로필 생성/수정 API
- **엔드포인트**: `POST/PUT /api/users/ideal-type/`
- **작업 내용**:
  - `IdealTypeProfileSerializer`에서 생성/수정 로직 구현
  - `IdealTypeView` 구현 (POST/PUT)
  - 유효성 검증 (height_min/max, age_min/max, preferred_*)
  - 모든 조건 최소 1개 이상 검증
  - 키/나이 범위 검증 (min <= max)

**우선순위**: ⭐⭐⭐⭐

---

### 4. 매칭 시스템 API

#### 4-1. 매칭 가능 인원 수 조회 API
- **파일**: `backend/apps/matching/views.py`, `urls.py`
- **엔드포인트**: `GET /api/matches/matchable-count/?latitude=37.5665&longitude=126.9780&radius=0.05`
- **작업 내용**:
  - 거리 계산 함수 구현 (하버사인 공식 또는 geopy 사용)
  - 반경 내 사용자 필터링
  - 이상형 조건 매칭 알고리즘
  - 매칭 동의된 사용자만 필터링 (`matching_consent=True`, `service_active=True`)
  - 매칭 가능한 인원 수 반환

#### 4-2. 매칭 체크 API
- **엔드포인트**: `GET /api/matches/check/`
- **작업 내용**:
  - 현재 위치 기준으로 새로운 매칭 발견 여부 확인
  - 매칭 알고리즘 실행
  - 양방향 매칭 확인 (양쪽 모두 이상형 조건 만족)
  - 매칭 임계값 확인 (기본 3개 이상 일치)
  - 매칭된 조건 정보 저장 (`matched_criteria`)
  - Match 모델 생성
  - Notification 모델 생성

#### 4-3. 매칭 이력 조회 API (선택사항)
- **엔드포인트**: `GET /api/matches/`
- **작업 내용**:
  - 현재 사용자의 매칭 이력 조회
  - 최신순 정렬

**우선순위**: ⭐⭐⭐⭐⭐ (핵심 기능)

---

### 5. 서비스 설정 API

#### 5-1. 매칭 동의 업데이트 API
- **엔드포인트**: `POST /api/users/consent/`
- **작업 내용**:
  - `matching_consent` 필드 업데이트
  - `consent_updated_at` 필드 업데이트
  - `service_active` 필드도 함께 관리 (선택사항)

**우선순위**: ⭐⭐⭐⭐

---

### 6. 알림 API

#### 6-1. 알림 목록 조회 API
- **파일**: `backend/apps/matching/views.py`
- **엔드포인트**: `GET /api/notifications/`
- **작업 내용**:
  - 현재 사용자의 알림 목록 조회
  - 최신순 정렬
  - 읽음/안 읽음 상태 포함

#### 6-2. 알림 상세 조회 API (선택사항)
- **엔드포인트**: `GET /api/notifications/{id}/`
- **작업 내용**:
  - 특정 알림의 상세 정보 조회
  - 매칭된 조건 정보 포함

**우선순위**: ⭐⭐⭐

---

## 🔵 프론트엔드 API 연동 (중간 우선순위)

### 1. API 클라이언트 확장

#### 1-1. 프로필 관련 함수
- **파일**: `Frontend/IdealMatchApp/src/services/api/apiClient.js`
- **작업 내용**:
  - `getProfile()` - 프로필 조회
  - `updateProfile(profileData)` - 프로필 생성/수정
  - `checkProfileCompleteness()` - 완성도 확인

#### 1-2. 이상형 프로필 관련 함수
- **작업 내용**:
  - `getIdealType()` - 이상형 프로필 조회
  - `updateIdealType(idealTypeData)` - 이상형 프로필 생성/수정

#### 1-3. 매칭 관련 함수
- **작업 내용**:
  - `getMatchableCount(latitude, longitude, radius)` - 매칭 가능 인원 수
  - `checkMatches()` - 매칭 체크
  - `getMatches()` - 매칭 이력 조회

#### 1-4. 서비스 설정 관련 함수
- **작업 내용**:
  - `updateConsent(consent, serviceActive)` - 매칭 동의 업데이트

#### 1-5. 알림 관련 함수
- **작업 내용**:
  - `getNotifications()` - 알림 목록 조회
  - `getNotification(id)` - 알림 상세 조회

**우선순위**: ⭐⭐⭐ (백엔드 API 구현 후)

---

### 2. AuthContext 실제 API 연동

#### 2-1. 프로필 관리 연동
- **파일**: `Frontend/IdealMatchApp/src/context/AuthContext.js`
- **작업 내용**:
  - Mock API 대신 실제 API 사용
  - `updateProfile()` 함수 수정
  - `updateIdealType()` 함수 수정
  - 프로필 완성도 체크 로직 추가

**우선순위**: ⭐⭐⭐

---

### 3. 화면 API 연동

#### 3-1. 프로필 입력 화면
- **파일**: `Frontend/IdealMatchApp/src/screens/Profile/ProfileInputScreen.js`
- **작업 내용**:
  - 실제 API 호출로 변경
  - 에러 처리 개선
  - 로딩 상태 표시

#### 3-2. 이상형 프로필 입력 화면
- **파일**: `Frontend/IdealMatchApp/src/screens/IdealType/IdealTypeInputScreen.js`
- **작업 내용**:
  - 실제 API 호출로 변경
  - 에러 처리 개선

#### 3-3. 메인 화면
- **파일**: `Frontend/IdealMatchApp/src/screens/Main/MainScreen.js`
- **작업 내용**:
  - 매칭 가능 인원 수 표시
  - 매칭 체크 주기적 호출 (10초마다)
  - 서비스 활성화/비활성화 기능
  - 프로필 완성도 확인

**우선순위**: ⭐⭐⭐⭐

---

## 🟡 프론트엔드 화면 구현 (낮은 우선순위)

### 1. 알림 화면
- **파일**: `Frontend/IdealMatchApp/src/screens/Notification/`
- **작업 내용**:
  - 알림 목록 화면 구현
  - 알림 상세 화면 구현
  - 매칭된 조건 정보 표시

**우선순위**: ⭐⭐

---

## 🟢 매칭 알고리즘 구현 (핵심 기능)

### 알고리즘 로직

#### 1. 거리 계산
- **방법**: 하버사인 공식 또는 geopy 라이브러리
- **필터링**: 반경 50m 이내 사용자만

#### 2. 매칭 조건 체크
- **조건 1**: 키 범위 (height_min ~ height_max)
- **조건 2**: 나이 범위 (age_min ~ age_max)
- **조건 3**: MBTI (preferred_mbti 리스트에 포함)
- **조건 4**: 성격 (preferred_personality 리스트와 교집합)
- **조건 5**: 관심사 (preferred_interests 리스트와 교집합)

**매칭 임계값**: 4개 이상 일치 (키, 나이, MBTI, 성격, 관심사 중)

#### 3. 양방향 매칭 확인
- 사용자 A → 사용자 B 조건 체크
- 사용자 B → 사용자 A 조건 체크
- 양쪽 모두 만족 시 매칭 성공

#### 4. 필터링 조건
- `matching_consent = True`
- `service_active = True`
- 위치 정보가 있는 사용자만

**우선순위**: ⭐⭐⭐⭐⭐ (핵심 기능)

---

## 📝 백엔드 작업 순서 제안

### Phase 1: 위치 & 프로필 (1일차)
1. ✅ 위치 업데이트 API
2. 프로필 조회/생성/수정 API
3. 이상형 프로필 조회/생성/수정 API
4. 프로필 완성도 확인 API

### Phase 2: 매칭 알고리즘 (2일차)
1. 거리 계산 함수 구현
2. 매칭 알고리즘 구현
3. 매칭 가능 인원 수 API
4. 매칭 체크 API

### Phase 3: 서비스 설정 & 알림 (3일차)
1. 매칭 동의 업데이트 API
2. 알림 목록 조회 API
3. 매칭 시 알림 생성 로직

### Phase 4: 통합 테스트 (4일차)
1. 전체 플로우 테스트
2. 버그 수정
3. 성능 최적화

---

## 📝 프론트엔드 작업 순서 제안

### Phase 1: API 클라이언트 확장 (백엔드 Phase 1과 병렬 가능)
1. 프로필 관련 API 함수 추가
2. 이상형 프로필 관련 API 함수 추가
3. 매칭 관련 API 함수 추가 (구조만, 실제는 Phase 2 후)

### Phase 2: 화면 연동 (백엔드 Phase 1 완료 후)
1. 프로필 입력 화면 연동
2. 이상형 프로필 입력 화면 연동
3. AuthContext 실제 API 연동

### Phase 3: 메인 화면 완성 (백엔드 Phase 2 완료 후)
1. 매칭 가능 인원 수 표시
2. 매칭 체크 주기적 호출
3. 서비스 활성화/비활성화 기능

### Phase 4: 알림 화면 (백엔드 Phase 3 완료 후)
1. 알림 목록 화면 구현
2. 알림 상세 화면 구현

---

## 🔍 확인이 필요한 사항

### 1. API 엔드포인트 경로
- 현재 API 클라이언트: `/users/location/update/`
- 협업 가이드: `/auth/register/`
- 실제 백엔드 URL 구조 확인 필요

### 2. 매칭 알고리즘 세부사항
- 매칭 임계값: 3개 vs 4개? (LOGIC_PLANNER에는 4개)
- 조건 우선순위: 모두 동등한지?
- 중복 매칭 방지: 같은 사용자와 다시 매칭되는지?

### 3. 알림 중복 방지
- LOGIC_PLANNER에 5분 내 중복 알림 방지 언급
- 구현 여부 확인 필요

---

## 📚 참고 문서

- `backend/API_USAGE_GUIDE.md` - API 사용 가이드
- `backend/API_DOCUMENTATION.md` - API 문서
- `LOGIC_PLANNER.md` - 전체 개발 계획
- `로그인_기능_협업_가이드.md` - 로그인 구현 가이드

---

**마지막 업데이트**: 2025-01-15
