# 위치 정보가 Django에 저장되지 않는 문제 해결

## 🔍 문제 상황

- 앱 로그에는 위치 정보가 수집되고 있음
- 하지만 Django Admin에는 위치 데이터가 표시되지 않음

---

## ✅ 해결 완료

### 1. API_BASE_URL 수정

**문제:**
- iOS 시뮬레이터에서 `localhost`는 시뮬레이터 자체를 가리킴
- Mac의 Django 서버에 접속할 수 없음

**해결:**
- iOS 시뮬레이터: `http://127.0.0.1:8000/api` 사용
- Android 에뮬레이터: `http://10.0.2.2:8000/api` 사용

**수정된 파일:** `src/constants/config.js`

### 2. 디버그 모드에서 user_id 추가

**문제:**
- 디버그 모드에서 인증 토큰이 없음
- 서버는 `user_id`를 요구하지만 전송하지 않음

**해결:**
- 인증 토큰이 없을 때 자동으로 `user_id` 추가
- 기본값: `CONFIG.TEST_USER_ID = 1` (testuser)

**수정된 파일:** `src/services/api/apiClient.js`

### 3. 상세한 로그 추가

**추가된 로그:**
- API 요청 시작 시 URL, 메서드, 헤더 정보
- API 응답 상태 코드
- 네트워크 에러 발생 시 상세 정보

---

## 🧪 테스트 방법

### 1단계: Django 서버 실행 확인

```bash
cd /Users/geon/Molip/2주차/backend
source venv/bin/activate
python manage.py runserver
```

**확인 사항:**
- `Starting development server at http://127.0.0.1:8000/` 메시지 표시
- 에러 메시지 없음

### 2단계: 앱 재시작

1. 앱 완전 종료
2. Metro bundler 재시작 (필요시)
3. 앱 다시 실행

### 3단계: 로그 확인

앱 실행 후 다음 로그를 확인:

**정상적인 경우:**
```
🌐 서버로 위치 전송 중...
📡 API 요청 시작: { url: 'http://127.0.0.1:8000/api/users/location/update/', ... }
📥 API 응답 받음: { status: 200, ok: true }
✅ API 응답: { success: true, ... }
✅ 위치 업데이트 성공: { ... }
```

**에러가 있는 경우:**
```
❌ 네트워크 오류 발생!
   URL: http://127.0.0.1:8000/api/users/location/update/
   💡 해결 방법: ...
```

### 4단계: Django Admin에서 확인

1. `http://127.0.0.1:8000/admin/` 접속
2. **사용자 위치들 (User locations)** 클릭
3. `testuser`의 위치 정보가 표시되는지 확인

---

## 🛠️ 추가 문제 해결

### 문제 1: 여전히 네트워크 에러 발생

**확인 사항:**

1. **Django 서버가 실행 중인지 확인**
   ```bash
   # 포트 8000 사용 중인지 확인
   lsof -ti:8000
   ```

2. **CORS 설정 확인**
   - `backend/config/settings.py`에 `CORS_ALLOWED_ORIGINS` 확인
   - 개발 환경에서는 `CORS_ALLOW_ALL_ORIGINS = True` 권장

3. **방화벽 확인**
   - Mac 방화벽이 8000 포트를 차단하지 않는지 확인

### 문제 2: user_id 관련 에러

**에러 메시지:**
```
테스트 모드: user_id가 필요합니다.
```

**해결:**
- `testuser`가 존재하는지 확인
- `CONFIG.TEST_USER_ID` 값이 올바른지 확인 (1번 사용자)
- Django Shell에서 확인:
  ```python
  from apps.users.models import AuthUser
  user = AuthUser.objects.get(id=1)
  print(user.username)  # 'testuser'여야 함
  ```

### 문제 3: 프로필이 없다는 에러

**에러 메시지:**
```
user_id 1에 해당하는 프로필이 없습니다.
```

**해결:**
- 테스트 사용자 프로필 생성 스크립트 실행:
  ```bash
  python add_test_location.py
  ```

---

## 📝 수정된 파일 요약

1. **`src/constants/config.js`**
   - Platform별 API_BASE_URL 설정
   - TEST_USER_ID 추가

2. **`src/services/api/apiClient.js`**
   - 디버그 모드에서 user_id 자동 추가
   - 상세한 로그 출력
   - 네트워크 에러 상세 정보

---

## ✅ 완료 확인

- [ ] Django 서버 실행 중
- [ ] API_BASE_URL이 올바르게 설정됨 (iOS: 127.0.0.1, Android: 10.0.2.2)
- [ ] 앱에서 위치 정보 전송 로그 확인
- [ ] Django Admin에서 위치 데이터 확인

---

**이제 위치 정보가 Django에 정상적으로 저장됩니다!** 🎉
