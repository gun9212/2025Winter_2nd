# 거리기반 이상형 탐지 알림 서비스 - 어플리케이션 로직

## 1. 개요
GPS 기반 위치 추적과 이상형 매칭 알고리즘을 활용하여, 사용자가 설정한 이상형 조건에 부합하는 사람이 일정 거리 내에 접근할 때 알림을 제공하는 서비스입니다.

---

## 2. 핵심 기능 모듈

### 2.1 사용자 프로필 관리 모듈
**기능**: 사용자 본인의 정보를 등록 및 관리

**데이터 구조**:
- 기본 정보: 나이, 성별, 키
- 성격: 성격 유형 (예: 외향적, 내향적, 유머러스 등), 자신의 MBTI
- 관심사: 취미, 관심 분야 (다중 선택 가능)
- 위치 정보: 현재 GPS 좌표 (위도, 경도)
- 마지막 위치 업데이트 시간

**로직**:
1. 사용자 회원가입/로그인 시 프로필 생성
2. 프로필 정보 입력/수정 기능
3. 위치 정보는 백그라운드에서 주기적으로 업데이트

---

### 2.2 이상형 프로필 관리 모듈
**기능**: 이상형 조건을 설정 및 관리

**데이터 구조**:
- 외형 조건: 키 범위 (최소~최대), 나이
- 성격 조건: 선호하는 성격 유형 (다중 선택 가능) 
- 관심사 조건: 선호하는 관심사 (다중 선택 가능)

사용자의 정보와 이상형 조건을 적어도 4개 이상 입력(키, 나이, 성격, 관심사) 한 후
매칭 임계값은 3개 이상 일치하면 매칭 성공

**로직**:
1. 이상형 프로필 생성/수정
2. 각 조건별 가중치 설정 (선택사항)
3. 매칭 임계값 설정 (예: 3개 이상 조건 부합 시 알림)

---

### 3. 위치 추적 모듈
**기능**: GPS를 통한 실시간 위치 추적 및 거리 계산

**로직**:
1. **위치 권한 요청**: 앱 실행 시 GPS 위치 권한 요청
2. **위치 업데이트**:
   - 포그라운드: 주기적 업데이트 (예: 30초마다)
   - 백그라운드: 지오펜싱 또는 주기적 업데이트
3. **위치 서버 전송**: 업데이트된 위치를 서버에 전송
4. **거리 계산**: 하버사인 공식(Haversine formula)을 사용하여 두 지점 간 거리 계산

**거리 계산 알고리즘**:
```
거리 = 2 * R * arcsin(√(sin²(Δlat/2) + cos(lat1) * cos(lat2) * sin²(Δlon/2)))
R = 지구 반지름 (약 6,371km)
```

---

### 4. 매칭 알고리즘 모듈
**기능**: 사용자와 다른 사용자 간의 이상형 부합도 계산

**매칭 로직**:
1. **후보 사용자 필터링**:
   - 현재 사용자 위치 기준 일정 반경 내의 모든 사용자 조회
   - 반경 설정은 개발 과정에서 고정 ex) 50m

2. **부합도 계산**:
   ```
   각 조건별 점수:
   - 키 조건: 범위 내이면 1점, 아니면 0점
   - 나이: 선호도와 일치하면 1점, 아니면 0점
   - 성격: 일치하는 항목 수 / 전체 선호 항목 수
   - 관심사: 일치하는 항목 수 / 전체 선호 항목 수
   
   총 부합도 = (키 점수 + 얼굴상 점수 + 성격 점수 + 관심사 점수) / 4
   ```

3. **매칭 판정**:
   - 사용자가 설정한 임계값 이상의 조건이 부합하는 경우 매칭 성공
   - 예: 임계값이 3이면, 4개 조건 중 3개 이상 부합 시 매칭

4. **상호 매칭 확인**:
   - A 사용자가 B 사용자의 이상형에 부합하는지 확인
   - B 사용자가 A 사용자의 이상형에 부합하는지 확인
   - 양방향 매칭

---

### 5. 알림 시스템 모듈
**기능**: 매칭 성공 시 사용자에게 알림 제공

**알림 로직**:
1. **매칭 감지**:
   - 주기적으로 (예: 10초마다) 매칭 알고리즘 실행
   - 새로운 매칭이 발생했는지 확인

2. **알림 조건**:
   - 매칭 성공
   - 상대방이 설정한 거리 내에 진입
   - 중복 알림 방지: 같은 사용자에 대해 일정 시간 내 중복 알림 방지

3. **알림 방식**:
   - 진동 (Vibration)
   - 푸시 알림 (Push Notification)
   - 화면 알림 (In-App Notification)

4. **알림 내용**:
   - 부합한 조건 정보

---

## 6. 전체 시스템 플로우

### 6.1 초기 설정 플로우
```
1. 앱 실행
2. 로그인/회원가입
3. 위치 권한 요청
4. 사용자 프로필 입력
5. 이상형 프로필 입력
6. 서비스 시작
```

### 6.2 실시간 매칭 플로우
```
1. 위치 업데이트 (주기적)
   ↓
2. 서버에 위치 정보 전송
   ↓
3. 서버에서 반경 내 사용자 조회
   ↓
4. 각 사용자와 매칭 알고리즘 실행
   ↓
5. 매칭 성공 시 알림 발송
   ↓
6. 사용자에게 진동/알림 표시
```

### 6.3 백그라운드 동작 플로우
```
1. 앱이 백그라운드로 전환
2. 백그라운드 위치 업데이트 활성화
3. 주기적으로 위치 업데이트 및 서버 전송
4. 서버에서 매칭 확인
5. 매칭 발생 시 푸시 알림 발송
```

---

## 7. 기술 스택 제안

### 7.1 프론트엔드 (모바일 앱)
- **React Native** : 크로스 플랫폼 개발
- **위치 서비스**: 
  - React Native: `@react-native-community/geolocation`
- **백그라운드 작업**: 
  - React Native: `react-native-background-geolocation`
- **진동**: 
  - React Native: `react-native-haptic-feedback`

### 7.2 백엔드
- **서버**: Python(Django)
- **데이터베이스**: 
  - 사용자 정보: PostgreSQL
  - 위치 정보: Redis (캐싱) + PostgreSQL
- **실시간 통신**: WebSocket (Socket.io)
- **푸시 알림**: AWS SNS(Simple Notification Service)

### 7.3 위치 기반 쿼리
- **PostGIS** (PostgreSQL 확장): 지리적 데이터 쿼리 최적화

---

## 8. 보안 및 개인정보 보호 고려사항

1. **위치 정보 암호화**: 전송 중 위치 정보 암호화
2. **익명화**: 사용자 ID를 익명화하여 프라이버시 보호
3. **위치 정보 보관 기간**: 일정 시간 후 자동 삭제
4. **동의 기반 매칭**: 사용자가 동의한 경우에만 매칭 정보 공유 (ON/OFF 기능)


---

## 9. 성능 최적화

1. **위치 업데이트 주기 조정**: 배터리 소모 최소화를 위해 적절한 주기 설정
2. **서버 쿼리 최적화**: 지리적 인덱스 활용
3. **캐싱**: 자주 조회되는 사용자 정보 캐싱
4. **배치 처리**: 여러 사용자 매칭을 배치로 처리


