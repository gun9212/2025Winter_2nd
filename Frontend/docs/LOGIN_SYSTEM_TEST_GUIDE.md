# 로그인 시스템 테스트 가이드

## 변경 사항 요약

기존 전화번호 인증 기반 시스템을 ID/PW 로그인 시스템으로 전환하였습니다.

### 주요 변경 사항

1. **새로운 화면**
   - 로그인 화면 (LoginScreen)
   - 회원가입 화면 (SignupScreen)
   - 비밀번호 재설정 화면 (PasswordResetScreen)

2. **인증 시스템**
   - Mock 인증 서버 구축 (mockAuthServer.js)
   - ID/PW 기반 로그인
   - 전화번호 인증 (회원가입 및 비밀번호 재설정 시)

3. **데이터 관리**
   - userId별 프로필/이상형 저장
   - 레거시 데이터 자동 마이그레이션
   - 다중 계정 지원

## 테스트 계정

앱 시작 시 자동으로 생성되는 테스트 계정:

- **계정 1**: ID: `test1`, PW: `test123`, 전화번호: `01012345678`
- **계정 2**: ID: `test2`, PW: `test123`, 전화번호: `01087654321`

**인증번호**: 모든 전화번호 인증에서 `123456` 사용 (Mock)

## 테스트 시나리오

### 시나리오 1: 신규 회원가입 및 프로필 설정

1. 앱 시작 → 로그인 화면 표시
2. "회원가입" 버튼 클릭
3. 회원가입 정보 입력:
   - ID: `newuser` (4자 이상)
   - 비밀번호: `password123` (6자 이상)
   - 비밀번호 확인: `password123`
   - 전화번호: `01099999999`
4. "인증번호 전송" 클릭
5. 인증번호 입력: `123456`
6. "회원가입" 클릭
7. 자동 로그인 후 프로필 입력 화면 이동
8. 프로필 정보 입력 (나이, 성별, 키, 성격, MBTI, 관심사)
9. "다음" 클릭 → 이상형 입력 화면
10. 이상형 정보 입력
11. "완료" 클릭 → 메인 화면 이동

**예상 결과**: 정상적으로 회원가입 후 메인 화면에 도달

### 시나리오 2: 기존 계정 로그인

1. 앱 시작 → 로그인 화면
2. ID: `test1`, PW: `test123` 입력
3. "로그인" 클릭
4. 프로필이 없으면 프로필 입력 화면, 있으면 메인 화면

**예상 결과**: 로그인 성공 후 적절한 화면 이동

### 시나리오 3: 비밀번호 재설정

1. 로그인 화면에서 "비밀번호 재설정" 클릭
2. ID: `test1` 입력
3. 전화번호: `01012345678` 입력
4. "인증번호 전송" 클릭
5. 인증번호: `123456` 입력
6. "본인 확인" 클릭
7. 새 비밀번호: `newpass123` 입력
8. 새 비밀번호 확인: `newpass123` 입력
9. "비밀번호 재설정" 클릭
10. 로그인 화면으로 이동
11. ID: `test1`, PW: `newpass123`으로 로그인

**예상 결과**: 비밀번호 재설정 성공 및 새 비밀번호로 로그인 가능

### 시나리오 4: 레거시 데이터 마이그레이션

**전제조건**: 이전 버전의 앱에서 전화번호 인증으로 프로필을 생성했던 경우

1. 회원가입 (또는 테스트 계정으로 로그인)
2. 로그인 시 자동으로 레거시 데이터 마이그레이션 실행
3. 메인 화면에 기존 프로필 및 이상형 데이터 표시

**예상 결과**: 기존 데이터가 새 계정에 자동으로 연결됨

### 시나리오 5: 프로필/이상형 수정

1. 메인 화면에서 "프로필 수정" 또는 "이상형 수정" 버튼 클릭
2. 기존 입력된 정보가 미리 채워진 상태로 표시
3. 원하는 정보 수정
4. 저장
5. 메인 화면으로 돌아와서 변경사항 확인

**예상 결과**: 기존 정보가 미리 채워지고 수정 가능

### 시나리오 6: 로그아웃 및 재로그인

1. 메인 화면에서 "로그아웃" 버튼 클릭
2. 로그인 화면으로 이동
3. 다른 계정으로 로그인 (예: test2)
4. 각 계정의 프로필이 독립적으로 관리되는지 확인

**예상 결과**: 각 사용자의 프로필이 독립적으로 저장/로드됨

## 검증 포인트

### 1. 입력 유효성 검사

- [ ] ID 4자 미만 입력 시 에러
- [ ] 비밀번호 6자 미만 입력 시 에러
- [ ] 비밀번호 불일치 시 에러
- [ ] 전화번호 형식 오류 시 에러
- [ ] 인증번호 불일치 시 에러

### 2. 중복 체크

- [ ] 중복 ID 회원가입 시도 시 에러
- [ ] 중복 전화번호 회원가입 시도 시 에러

### 3. 로그인 검증

- [ ] 잘못된 ID 입력 시 "존재하지 않는 ID" 메시지
- [ ] 잘못된 비밀번호 입력 시 "비밀번호가 일치하지 않습니다" 메시지

### 4. 데이터 영속성

- [ ] 로그아웃 후 재로그인 시 프로필 유지
- [ ] 앱 종료 후 재시작 시 로그인 상태 유지 (선택적)
- [ ] 앱 종료 후 재시작 시 각 사용자의 프로필 유지

### 5. 네비게이션 플로우

- [ ] 회원가입 후 프로필 입력 화면으로 이동
- [ ] 프로필 입력 후 이상형 입력 화면으로 이동
- [ ] 이상형 입력 후 메인 화면으로 이동
- [ ] 프로필/이상형 모두 있는 경우 로그인 후 바로 메인 화면

### 6. UI/UX

- [ ] 로딩 중 버튼 비활성화
- [ ] 에러 메시지 명확하게 표시
- [ ] 테스트 계정 정보 표시 (개발 단계)

## 기술 세부사항

### 데이터 저장 구조

```
AsyncStorage:
├── @mock_users_db (사용자 DB)
├── @current_user (현재 로그인된 사용자)
├── @user_profile_{userId} (사용자별 프로필)
├── @ideal_type_{userId} (사용자별 이상형)
└── @data_migration_completed (마이그레이션 플래그)

레거시 키 (마이그레이션용):
├── @user_profile
└── @ideal_type
```

### 주요 파일

- **서비스**: `src/services/mock/mockAuthServer.js`
- **Context**: `src/context/AuthContext.js`
- **Storage**: `src/services/storage/storage.js`
- **마이그레이션**: `src/services/migration/dataMigration.js`
- **네비게이션**: `src/navigation/RootNavigator.js`
- **화면**: `src/screens/Auth/*.js`

## 문제 해결

### 문제: 로그인 후 빈 화면

**원인**: 프로필 또는 이상형 데이터 누락
**해결**: 
1. AsyncStorage 확인
2. 프로필 입력 화면으로 이동 여부 확인
3. 필요시 로그아웃 후 재로그인

### 문제: 인증번호가 작동하지 않음

**원인**: Mock 인증번호 불일치
**해결**: `123456` 입력 (하드코딩된 값)

### 문제: 테스트 계정이 없음

**원인**: mockAuthServer.createTestAccounts() 미실행
**해결**: 앱 재시작 (AuthProvider의 useEffect에서 자동 생성)

### 문제: 레거시 데이터가 마이그레이션되지 않음

**원인**: 마이그레이션 플래그가 이미 설정됨
**해결**: 
```javascript
// 개발자 도구에서 실행
import { dataMigration } from './src/services/migration';
await dataMigration.resetMigrationFlag();
```

## 다음 단계

1. ✅ Mock 인증 서버 → **실제 백엔드 API로 교체**
2. ✅ 전화번호 인증 → **AWS SNS 통합**
3. ⬜ 비밀번호 해싱 (현재는 평문 저장)
4. ⬜ JWT 토큰 관리
5. ⬜ 자동 로그인 옵션
6. ⬜ 소셜 로그인 추가 (선택사항)

## 성능 고려사항

- AsyncStorage는 모든 작업이 비동기
- 대규모 사용자 DB는 서버에서 관리해야 함
- 현재 Mock 구현은 개발/테스트 목적

## 보안 고려사항

- 현재 비밀번호는 평문으로 저장 (Mock)
- 실제 배포 시 서버에서 bcrypt 등으로 해싱 필요
- JWT 토큰 관리 및 만료 처리 필요
- HTTPS 통신 필수
